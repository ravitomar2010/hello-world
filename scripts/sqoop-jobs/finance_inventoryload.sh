#!/bin/bash

export HADOOP_HOME=/home/hadoop/hadoop
export HADOOP_INSTALL=$HADOOP_HOME
export HADOOP_MAPRED_HOME=$HADOOP_HOME
export HADOOP_COMMON_HOME=$HADOOP_HOME
export HADOOP_HDFS_HOME=$HADOOP_HOME
export YARN_HOME=$HADOOP_HOME
export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_HOME/lib/native
export PATH=$PATH:$HADOOP_HOME/sbin:$HADOOP_HOME/bin
export HADOOP_OPTS="-Djava.library.path=$HADOOP_HOME/lib/native -Djava.security.egd=file:/dev/../dev/urandom"
export SQOOP_HOME=/usr/lib/sqoop export PATH=$PATH:$SQOOP_HOME/bin
export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:$HADOOP_HOME/share/hadoop/tools/lib/*

echo "Starting with the execution"

/usr/bin/sqoop import --connect jdbc:oracle:thin:@172.27.55.33:1531/AXMS --username EBS --password ebs123 --query "SELECT ORGANIZATION_ID,INVENTORY_ITEM_ID,SUBINVENTORY_CODE,TRANSACTION_DATE,TRANSACTION_QUANTITY,ACCOUNTING_LINE_TYPE,BASE_TRANSACTION_VALUE,UNIT_COST,TRANSACTION_TYPE_ID,TRANSACTION_ID,REFERENCE_ACCOUNT,MSI_ORGANIZATION_ID,MTA_TRANSACTION_DATE,MSI_INVENTORY_ITEM_ID,TRANSACTION_REFERENCE,COST_ELEMENT_ID FROM APPS.CST_INV_DISTRIBUTION_V WHERE TRUNC(TRANSACTION_DATE) BETWEEN TRUNC(TRUNC(SYSDATE,'MM')-1,'MM') AND TRUNC(SYSDATE,'MM')-1 AND TRUNC(MTA_TRANSACTION_DATE) BETWEEN TRUNC(TRUNC(SYSDATE,'MM')-1,'MM') AND TRUNC(SYSDATE,'MM')-1 AND ORGANIZATION_ID IN (302,2058,303,202,203,204,205,206,207,208,209,216,255,256,257,258,280,281,344,347,348,370,392,433,453,474,534,554,574,654,674,694,735,834,854,874,894,914,934,1014,1034,1054,1135,1094,1176,1342,1536,1236,1576,735,1736,1756,1776,1816,1878,1656,1838,1596,1958,1978,2018,2038,2078,2098,2138,2158,2178,2198,2218,2238,2118,2278,2298) AND MSI_ORGANIZATION_ID IN (302,2058,303,202,203,204,205,206,207,208,209,216,255,256,257,258,280,281,344,347,348,370,392,433,453,474,534,554,574,654,674,694,735,834,854,874,894,914,934,1014,1034,1054,1135,1094,1176,1342,1536,1236,1576,735,1736,1756,1776,1816,1878,1656,1838,1596,1958,1978,2018,2038,2078,2098,2138,2158,2178,2198,2218,2238,2118,2278,2298) AND \$CONDITIONS" --delete-target-dir --target-dir s3a://axiom-stage-data/a2i/stage1/ERP/FINANCE/SQOOP/CST_INV_DISTRIBUTION_V/ --fields-terminated-by '|'  --split-by INVENTORY_ITEM_ID -m 1 --hive-drop-import-delims --enclosed-by '"' --null-string '\\N' --null-non-string '\\N' -m 10

echo "Done with the execution"
